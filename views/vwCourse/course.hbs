{{#section 'css'}}
<style>
  a:hover{
    text-decoration: none;
  }
  .course-card {
    position: relative !important;
  }

  .badge.badge-danger {
    position: absolute !important;
    left: 85%;
    top: 5;
    width: 10%;
    opacity: 0;
  }

    .bleft {
    position: absolute !important;
    left: 2%!important;
    top: 2%!important;
    width: 20%;
    opacity: 1;
    z-index: 2;
    font-size: 14px;
    background-color: rgb(212, 24, 11);
    border-radius: 5px;
  }
  .bleftnew {
    position: absolute !important;
    left: 2%!important;
    top: 2%!important;
    width: 20%;
    opacity: 1;
    z-index: 2;
    font-size: 14px;
    background-color: rgb(212, 154, 29);
    border-radius: 5px;
  }
  .bright {
    position: absolute !important;
    left: 25%!important;
    top: 2%!important;
    width: 20%;
    opacity: 1;
    z-index: 2;
    font-size: 14px;
    background-color:  rgb(212, 154, 29);
    border-radius: 5px;
  }
  .bhot {
    font-size: 14px;
    width: 20%;
    background-color: rgb(3, 173, 159);
    border-radius: 5px;
  }
</style>
{{/section}}

{{#section 'js'}}
<script src="/js/courses.js"></script>
<script src="/js/main.js"></script>
{{/section}}

<main>
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb" style="background-color: #ffffff!important; margin-bottom:0px!important">
        <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
        <li class="breadcrumb-item active" aria-current="page">Khóa học</li>
      </ol>
    </nav>
  </div>
  <div class="page-section bg-light" style="padding-top: 20px;">
    <div class="container">
      <form class="search-form mb-5">
        <div class="form-group formsearch">
          <input type="text" class="form-control search" placeholder="Nhập tên khóa học hoặc lĩnh vực">
          <button type="button" class="btn btnsearch">Tìm kiếm</button>
        </div>
      </form>
      <div class="row">
        <div class="col-lg-4">
          <div class="course-filter">
            <h5>Sắp xếp</h5>
            <select id="sort" class="custom-select">
              <option value="-1">Mặc định</option>
              {{#each listCategory}}
              <option value="{{this.id}}">{{this.name}}</opion>
                {{/each}}
            </select>

            <hr>

            <h5>Giá</h5>
            <ul class="course-filter-list">
              <li>
                <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input" id="price1" name="sort" value="priceincrease">
                  <label class="custom-control-label" for="price1">Tăng dần</label>
                </div>
              </li>
              <li>
                <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input" id="price2" name="sort" value="pricedecrease">
                  <label class="custom-control-label" for="price2">Giảm gần</label>
                </div>
              </li>
            </ul>

            <hr>

            <h5>Điểm đánh giá</h5>
            <ul class="course-filter-list">
              <li>
                <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input" id="rating1" name="sort" value="rateincrease">
                  <label class="custom-control-label" for="rating1">Tăng dần</label>
                </div>
              </li>
              <li>
                <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input" id="rating2" name="sort" value="ratedecrease">
                  <label class="custom-control-label" for="rating2">Giảm gần</label>
                </div>
              </li>
            </ul>

            <hr>

            <h5>Khóa học</h5>
            <ul class="course-filter-list">
              <li>
                <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input" id="course1" name="sort" value="newcourse">
                  <label class="custom-control-label" for="course1">Mới nhất</label>
                </div>
              </li>
              <li>
                <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input" id="course2" name="sort" value="learnestcourse">
                  <label class="custom-control-label" for="course2">Học nhiều nhất</label>
                </div>
              </li>
            </ul>


            <button class="btn btn-secondary btn-block space-up-32 btnreset">Reset</button>
          </div>
        </div>
        <div class="col-lg-8">
          <div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-3">
            {{#each listCourse}}
            <div class="item" id="{{id}}" style="cursor: pointer;">
              <div class="course-card">
                {{#if ishot}}
                <div class="bleft d-flex justify-content-center align-items-center"><span class="" style="color: white;">Hot</span></div>
                {{#if offer}}
                <div class="bright d-flex justify-content-center align-items-center"><span class="" style="color: white;">-{{offer}}%</span></div>
                {{/if}}
                {{else}}
                {{#if offer}}
                <div class="bleftnew d-flex justify-content-center align-items-center"><span class="" style="color: white;">-{{offer}}%</span></div>
                {{/if}}
                {{/if}}

                <div class="badge badge-danger d-flex justify-content-center align-items-center">
                  <a href="/account/addwatchlist/{{id}}" style="color: white;">
                  <i class="fa fa-heart-o fa-lg" aria-hidden="true"></i>
                  </a>
                </div>
                <a href="/course/{{id}}">
                  <div class="header">
                    <img src="/img/course/{{img}}" alt="">
                  </div>
                </a>
                <div class="content text-left">
                  {{#if isnew}}
                  <div class="bhot d-flex justify-content-center align-items-center"><span class="" style="color: white;">New</span></div>
                  {{/if}}
                  
                  <p class="course-title"><a href="/course/{{id}}">{{this.name}}</a></p>
                  <small style="margin-bottom:0!important;color: #3f3c3c; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">{{this.catname}}</small>
                  </br>
                  <small style="color: #676565; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">
                    {{#each this.teacher}}
                    {{this.fullname}},
                    {{/each}}
                  </small>
                  <div class="rating">
                    <span class="number-rating"><b>{{rating}}</b></span>
                    {{{this.rating_star}}}
                    <span class="person-rating" style="color:black;">({{this.num_of_rating}})</span>
                  </div>
                  <div class="price" style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">
                    <span class="text-danger font-weight-bold">{{this.current_price}}</span> 
                    <del class="text-muted">
                      {{this.price}}
                    </del>
                  </div>
                </div>
              </div>
            </div>
            {{/each}}

          </div> <!-- .row -->

          <nav aria-label="Pagination">
            <ul class="pagination justify-content-end mt-5">

              <li class="page-item prev disabled">
                <a style="cursor: pointer;" class="page-link">Prev</a>
              </li>
              <li class="page-item page1 active">
                <a style="cursor: pointer;" class="page-link">1</a>
              </li>
              {{#each this.page_items}}
              <li class="page-item page{{value}}">
                <a style="cursor: pointer;" class="page-link">{{value}}</a>
              </li>
              {{/each}}
              <li class="page-item next {{#unless can_go_next}}disabled{{/unless}}">
                <a style="cursor: pointer;" class="page-link">Next</a>
              </li>
            </ul>
          </nav>
        </div> <!-- .col-lg-8 -->
      </div> <!-- .row -->
    </div> <!-- .container -->
  </div> <!-- .page-section -->

  {{#if redirect}}
  <input type="hidden" id="idcate" value="{{idcate}}">
  <input type="hidden" id="keysearch" value="{{keysearch}}">
  <script>

    $(document).ready(function () {
      cate = $('#idcate').val();
      key = $('#keysearch').val();
      $("#sort").val(cate);
      $(".search").val(key);
      $.ajax({
        method: 'post',
        url: '/course',
        data: { cate: cate, key: key, check: undefined, page: "1" },
        dataType: 'json'
      })
        .done(function (data) {
          $('.col-lg-8 .row').html(data.html);
          // show pagination
          let nPage = data.nPages;
          let html = `
        <li class="page-item prev disabled">
          <a style="cursor: pointer;" class="page-link">Prev</a>
        </li>
        <li class="page-item page1 active">
        <a style="cursor: pointer;" class="page-link">1</a>
      </li>`;
          for (let i = 0; i < nPage - 1; i++) {
            html += `<li class="page-item page${i + 2}">
            <a style="cursor: pointer;" class="page-link">${i + 2}</a>
          </li>`
          }
          if (nPage != 1)
            html += ` <li class="page-item next">
        <a style="cursor: pointer;" class="page-link">Next</a>
      </li>`;
          else
            html += ` <li class="page-item next disabled">
        <a style="cursor: pointer;" class="page-link">Next</a>
      </li>`;
          $('.pagination').html(html);
          jsWatchList();
        })
        .catch(err => {
          console.log(err);
        });
    }); 
  </script>
  {{/if}}
</main>